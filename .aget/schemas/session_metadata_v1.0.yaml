# Session Metadata Schema v1.0.0
# Defines structure for session documentation frontmatter
# Used to address 60% session gap (Issue #29)

schema_version: "1.0.0"
description: "Structured session metadata for AGET sessions"
purpose: "Enable session mining, cross-AGET visibility, and collaboration context"

# Required fields (must be present in every session)
required_fields:
  - date
  - duration_minutes
  - objectives
  - outcomes

# Optional fields (recommended but not required)
optional_fields:
  - learnings
  - issues_filed
  - commits
  - files_changed
  - patterns_used
  - agets_collaborated
  - pain_points
  - next_steps

# Field definitions with types and constraints
fields:
  date:
    type: string
    format: "YYYY-MM-DD"
    description: "Session date"
    example: "2025-10-02"

  duration_minutes:
    type: integer
    minimum: 1
    maximum: 600  # 10 hours max
    description: "Session duration in minutes"
    example: 120

  objectives:
    type: array
    items:
      type: string
    minItems: 1
    description: "What the session aimed to accomplish"
    example:
      - "Implement pattern versioning system"
      - "Deploy to all AGETs"

  outcomes:
    type: array
    items:
      type: string
    minItems: 1
    description: "What was actually accomplished"
    example:
      - "Pattern versioning deployed to 11 AGETs"
      - "All tools tested and validated"

  learnings:
    type: array
    items:
      type: object
      properties:
        id:
          type: string
          pattern: "^L[0-9]+$"
        description:
          type: string
    description: "Learnings captured (L-number format)"
    example:
      - id: "L24"
        description: "Pattern versioning enables safe multi-agent collaboration"

  issues_filed:
    type: array
    items:
      type: object
      properties:
        number:
          type: integer
        title:
          type: string
        url:
          type: string
          format: uri
    description: "GitHub issues filed during session"
    example:
      - number: 29
        title: "Session Metadata Standard v1.0"
        url: "https://github.com/gmelli/aget-aget/issues/29"

  commits:
    type: array
    items:
      type: object
      properties:
        hash:
          type: string
          pattern: "^[a-f0-9]{7,40}$"
        message:
          type: string
    description: "Git commits made during session"
    example:
      - hash: "af45bdc"
        message: "vocabulary: Expand to v1.1.0 with v2.3 terms"

  files_changed:
    type: integer
    minimum: 0
    description: "Number of files modified"
    example: 15

  patterns_used:
    type: array
    items:
      type: object
      properties:
        name:
          type: string
        version:
          type: string
          pattern: "^[0-9]+\\.[0-9]+\\.[0-9]+$"
    description: "Patterns used during session with versions"
    example:
      - name: "github/create_issue"
        version: "1.0.0"

  agets_collaborated:
    type: array
    items:
      type: string
    description: "Other AGETs involved in session"
    example:
      - "my-CCB-aget"
      - "my-GITHUB-aget"

  pain_points:
    type: array
    items:
      type: string
    description: "Difficulties or frustrations encountered"
    example:
      - "Manual version tracking is tedious"
      - "No way to validate compatibility"

  next_steps:
    type: array
    items:
      type: string
    description: "Follow-up tasks for future sessions"
    example:
      - "Implement session metadata extraction"
      - "Test with 3 AGETs"

# Metadata format (YAML frontmatter in session markdown files)
frontmatter_format: |
  ---
  date: "2025-10-02"
  duration_minutes: 120
  objectives:
    - "Implement pattern versioning"
  outcomes:
    - "Versioning deployed to 11 AGETs"
  learnings:
    - id: "L24"
      description: "Pattern versioning enables collaboration"
  issues_filed:
    - number: 29
      title: "Session Metadata Standard"
  commits:
    - hash: "af45bdc"
      message: "vocabulary: Expand to v1.1.0"
  files_changed: 15
  patterns_used:
    - name: "github/create_issue"
      version: "1.0.0"
  ---

  # Session Notes

  Session content goes here...

# Validation rules
validation_rules:
  - "Date must be valid ISO 8601 date"
  - "Duration must be positive integer"
  - "Objectives must have at least one item"
  - "Outcomes must have at least one item"
  - "Learning IDs must match pattern L[0-9]+"
  - "Commit hashes must be valid git short/long hashes"
  - "Pattern versions must follow semver (X.Y.Z)"

# Usage notes
usage_notes:
  - "Metadata is automatically extracted during wind down"
  - "Required fields validated before session save"
  - "Optional fields added if data available"
  - "Coordinator can query metadata for session mining"
  - "Metadata used for cross-AGET visibility"

# Backwards compatibility
backwards_compatibility:
  - "Existing sessions without metadata still readable"
  - "Metadata optional for manual session creation"
  - "Schema versioned for future extensions"

---
# Examples

## Minimal Session (Required Fields Only)
---
date: "2025-10-02"
duration_minutes: 30
objectives:
  - "Quick bug fix"
outcomes:
  - "Fixed issue #45"
---

## Full Session (All Fields)
---
date: "2025-10-02"
duration_minutes: 480
objectives:
  - "Complete Gate A2"
  - "Deploy versioning system"
outcomes:
  - "Pattern versioning operational"
  - "Deployed to 11 AGETs"
learnings:
  - id: "L24"
    description: "Versioning critical for collaboration"
issues_filed:
  - number: 29
    title: "Session Metadata Standard"
    url: "https://github.com/gmelli/aget-aget/issues/29"
commits:
  - hash: "af45bdc"
    message: "vocabulary: Expand to v1.1.0"
  - hash: "81a2c30"
    message: "versioning: Add registry and tools"
files_changed: 25
patterns_used:
  - name: "github/create_issue"
    version: "1.0.0"
  - name: "routing/agent_registry"
    version: "1.0.0"
agets_collaborated:
  - "my-CCB-aget"
  - "my-GITHUB-aget"
pain_points:
  - "Manual metadata entry is tedious"
next_steps:
  - "Automate metadata extraction"
  - "Test on all AGETs"
---
